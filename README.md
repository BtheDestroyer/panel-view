# panel-view

Configurable webserver intended for providing updates and viewing the status of services.

![Example webpage](https://i.imgur.com/MWTMMDJ.png)

## Why?

I wanted an easier way of creating simple yet dynamic and reactive web pages than learning an entire web framework from scratch, so I made panel-view.

The main goals are:

1. Creating and updating pages should be easy and approachable.
2. Updating and extending the tool's feature set should be simple.
3. Data used to create page content should be intuitive to understand.

## How to run

1. Make sure Node.js is installed.
2. Clone this repository and open a command line in the cloned folder.
3. Start the program with the command `npm start`

I would recommend checking `config.yaml` to make sure the page's title, footer, and hosted port are as desired.

## How to Change the Style

The main CSS stylesheet is located at `static/style.css`. I've intentionally tried to keep it trimmed down so it's easy to edit and customize colors, font sizes, etc.

## How to create a panel

Creating a panel can be done either with data (via YAML) or with code (via Javascript).

### Via YAML

Create a file in the `panels` directory ending in `.yaml`. For example: `panels/my-panel.yaml`.

At minimum, your panel must include:

```yaml
title: "Hello Panels"
contents:

```

Within `contents`, you can create a list of entries that will be handled by the various Javascript modules in the `content-handlers` directory. When initially cloned, panel-view comes with a few content handlers preinstalled, each with their own example panel. The default available content entries include:

```yaml
contents:
- text: "Text to be added."
  italic: true # Optional setting for `text`
  bold: true # Optional setting for `text`
  underline: true # Optional setting for `text`
  strikethrough: true # Optional setting for `text`
- horizontalrule: true # Will draw a horizontal line above this entry; can be on its own
- image: "https://SourceImage.URL/"
- bullet: # Any content type can be added here as sub-entries
  - text: "Bullet item 1"
  - text: "Bullet item 2"
  - text: "Bullet item 3"
- list: # Any content type can be added here as sub-entries
  - text: "Numbered item 1"
  - text: "Numbered item 2"
  - text: "Numbered item 3"
- minecraft-status: # Pings a Minecraft server and retrieves its status
    host: "minecraft.domain.tld" # Server IP
    port: 25565 # Can be left out if the server has a SRV DNS record (eg: _minecraft._tcp.minecraft.domain.tld)
    display: # Sub-entries to use when creating the panel's content
      - text: "description.text: {description.text}" # values in {curly braces} will be replaced by the server's status
      - text: "players.max: {players.max}"
      - text: "players.online: {players.online}"
      - text: "players.list: {players.list}"
      - text: "version.name: {version.name}"
      - text: "version.protocol: {version.protocol}"
      - text: "favicon: {favicon}"
      - text: "host: {host}"
      - text: "port: {port}"
```

Keep in mind that using multiple content types in the same entry is not supported and will result in undefined behavior. For example:

```yaml
contents:
- bullet:
  - text: "Bullet point text"
  - text: "Bullet point text"
  text: "Separate text" # Bad: This entry already had a `bullet`
```

```yaml
contents:
- bullet:
  - text: "Bullet point text"
  - text: "Bullet point text"
- text: "Separate text" # Good: Now they're separate entries

```

Additionally, you can add a `priority` to a panel:

```yaml
title: "Important Update"
priority: 100
contents:
# ...
```

Panels are sorted with the highest priority showing at the top of the page. If no priority is provided, it defaults to `0`.

### Via Javascript

Sometimes you may want to create custom functionality in a panel. For that, you can create the panel manually using Javascript.
Create a file in the `panels` directory ending in `.js`. For example: `panels/my-panel.js`. Here's a starting point:

```js
const PG = require("../pagegen.js");

module.exports = {
    title: "Javascript Panel",
    drawContents: async () =>
    {
        // <p>This is being generated by <i>Javascript</i>.</p>
        return PG().p(
                PG("This is being generated by ")
                .i("Javascript")
                .append(".")
            );
    }
}
```

`drawContents` is called when it's time for your panel to be drawn. You can also give your panel a `priority` just like you can via YAML.

## How to Create a content-handler

If you want to add your own types of content, you can create a new Javascript file in the `content-handlers` directory. Here's a template to get started.

```js
const LOG = require("../log.js");
const PG = require("../pagegen.js");

module.exports = async function(entry)
{
    var section = PG();
    // Generate content here
    return section;
}
```

`pagegen` is my own HTML generation tool. It supports method chaining and a simple syntax:

```js
const PG = require("../pagegen.js");

var page = PG();
page.h1("Header")
    .p("Paragraph")
    .ol(
        PG().li("List item 1")
            .li("List item 2")
            .li("List item 3")
    )
    .img({ src: "/image.png" });

console.log(
    PG().DOCTYPE()
        .html(
            PG.body(page)
        ).finalize());
```

Output:

```html
<!DOCTYPE html>
<html>
<body>
    <h1>Header</h1>
    <p>Paragraph</p>
    <ol>
        <li>List item 1</li>
        <li>List item 2</li>
        <li>List item 3</li>
    </ol>
    <img src="/image.png" />
</body>
</html>
```

I would recommend thinking of a main entry parameter for your content-handler and using it as a condition. For example, the `text.js` content-handler uses the `text` parameter like this:

```js
const LOG = require("../log.js");
const PG = require("../pagegen.js");

module.exports = async function(entry)
{
    var section = PG();
    if (entry.text == undefined)
    {
        return section;
    }
    // Draw the rest of `text`
    return section;
}
```

## Serving Other Pages

### Serving Dynamic Files

Any Javascript files in the `pages` directory (including subdirectories) will be run if their relative URL is requested. For example, if I go to `/somepage` panel-view will check if the file `pages/somepage.js` exists and run it if it does. This can be useful for API endpoints or redirects.

To properly create a dynamic page that uses this feature, your Javascript module must export `generate: async function(req)` and `serve: async function (req, res)`. Here's a starting point:

```js
const PG = require("../pagegen.js");

module.exports = {
    generate: async function(req)
    {
        return PG().DOCTYPE()
            .html(
            PG().body(
                PG().h1('My dynamic page')
                )
            ).finalize()
    },
    serve: async function(req, res)
    {
        res.writeHead(200, {'Content-Type':'text/html'});
        res.end(this.generate(req));
    }
}
```

### Serving Static Files

Any files in the `static` directory (including subdirectories) will be served if their relative URL is requested. For example, `/favicon.ico` will try to serve `/static/favicon.ico`. This can be useful for serving additional pages, images, or other resources.

## Generating Static Pages

Some services (eg: Netlify) offer a static webserver service, meaning a dynamic webserver like Node can't be run to host the content. To mitigate this, you can run `node generate-static-pages` to "pre-compile" the HTML for your pages. This can even be done via CI/CD so your page is automatically regenerated every time you commit. Just make sure `generate-static-pages.export-dir` is set properly in `config.yaml`.
